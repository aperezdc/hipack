"use strict";(function(){function t(t){switch(t){case 9:case 10:case 13:case 32:return!0;default:return!1}}function e(t){switch(t){case 9:case 10:case 13:case 32:case 91:case 93:case 123:case 125:case 58:case 44:return!1;default:return!0}}function s(t){switch(t){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 97:case 65:case 98:case 66:case 99:case 67:case 100:case 68:case 101:case 69:case 102:case 70:return!0;default:return!1}}function r(t){switch(t){case 46:case 43:case 61:return!0;default:return s(t)}}function o(t){return t>48&&56>t}function i(t){switch(t){case 48:return 0;case 49:return 1;case 50:return 2;case 51:return 3;case 52:return 4;case 53:return 5;case 54:return 6;case 55:return 7;case 56:return 8;case 57:return 9;case 97:case 65:return 10;case 98:case 66:return 11;case 99:case 67:return 12;case 100:case 68:return 13;case 101:case 69:return 14;case 102:case 70:return 15}}var h=this,a=h.hipack,n={};if(n.noConflict=function(){return h.hipack=a,n},void 0===u){var u=function(){this._set=Object.create(null)};u.prototype.add=function(t){this._set[t]=!0},u.prototype.remove=function(t){delete this._set[t]},u.prototype.contains=function(t){return!!this._set[t]},u.prototype.clear=function(){this._set=Object.create(null)},u.prototype.empty=function(){return 0==Object.keys(this._set).length},u.prototype.size=function(){return Object.keys(this._set).length},u.prototype.get=function(){return Object.keys(this._set)}}n.ANNOT_INT=".int",n.ANNOT_FLOAT=".float",n.ANNOT_BOOL=".bool",n.ANNOT_STRING=".string",n.ANNOT_LIST=".list",n.ANNOT_DICT=".dict";var c=Object.keys,p=Array.isArray;n.DumpError=function(t){this.message=t,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack},n.value=function(t,e){return t},n.Dumper=function(t,e){void 0===e&&(e=n.value),this.indent=t?-1:0,this.value=e,this.output=""},n.Dumper.prototype.moreIndent=function(){this.indent>=0&&this.indent++},n.Dumper.prototype.lessIndent=function(){this.indent>0&&this.indent--},n.Dumper.prototype.dumpIndent=function(){for(var t=this.indent>=0?this.indent:0;t--;)this.output+="  "},n.Dumper.prototype.dumpString=function(t){this.output+='"';for(var e=0;e<t.length;e++){var s=t.charCodeAt(e);switch(s){case 9:this.output+="\\t";break;case 10:this.output+="\\n";break;case 13:this.output+="\\r";break;case 34:this.output+='\\"';break;case 92:this.output+="\\\\";break;default:32>s?(this.output+="\\",16>s&&(this.output+="0"),this.output+=s.toString(16).toUpperCase()):this.output+=t.charAt(e)}}this.output+='"'},n.Dumper.prototype.dumpBoolean=function(t){this.output+=t?"True":"False"},n.Dumper.prototype.dumpNumber=function(t){this.output+=t.toString()},n.Dumper.prototype.dumpKeyVal=function(t,e){for(var s=0;s<e.length;s++){this.dumpIndent(),this.output+=e[s];var r=t[e[s]];"object"!=typeof r&&(this.output+=":"),this.indent>=0&&(this.output+=" "),this.dumpValue(r),this.indent>=0?this.output+="\n":s<e.length-1&&(this.output+=",")}},n.Dumper.prototype.dumpList=function(t){if(0==t.length)return void(this.output+="[]");this.output+="[",this.moreIndent(),this.indent>=0&&(this.output+="\n");for(var e=0;e<t.length;e++)this.dumpIndent(),this.dumpValue(t[e]),this.indent>=0?this.output+="\n":e<t.length-1&&(this.output+=",");this.lessIndent(),this.output+="]"},n.Dumper.prototype.dumpDict=function(t){var e=c(t);return 0==e.length?void(this.output+="{}"):(this.output+="{",this.moreIndent(),this.indent>=0&&(this.output+="\n"),this.dumpKeyVal(t,e.sort()),this.lessIndent(),this.dumpIndent(),void(this.output+="}"))},n.Dumper.prototype.dumpValue=function(t){var e=new u;if(t=this.value(t,e),!e.empty()){this.indent<0&&":"!=this.output[this.output.length-1]&&(this.output+=":"),e=e.get();for(var s=0;s<e.length;s++)this.output+=":",this.output+=e[s];this.output+=" "}var r=typeof t;switch(r){case"number":this.dumpNumber(t);break;case"boolean":this.dumpBoolean(t);break;case"string":this.dumpString(t);break;case"object":if(null!==t){p(t)?this.dumpList(t):this.dumpDict(t);break}r="null";default:throw new n.DumpError("Values of type '"+r+"' cannot be dumped")}},n.dump=function(t,e,s){var r=new n.Dumper(Boolean(e),s),o=c(t);return r.dumpKeyVal(t,o.sort()),r.output};var l=-1,d=Number.parseInt,k=Number.parseFloat,f=String.fromCharCode;n.ParseError=function(t,e){this.message=e,this.position=t.pos,this.line=t.line,this.column=t.column,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack},n.cast=function(t,e,s){return s},n.Parser=function(t,e){void 0===e&&(e=n.cast),this.input=t,this.cast=e,this.look=0,this.line=1,this.column=0,this.pos=0,this.nextCharCode(),this.skipWhite(),this.framed=123==this.look},n.Parser.prototype.nextCharCodeRaw=function(){if(this.pos>=this.input.length)return l;var t=this.input.charCodeAt(this.pos++);return 10==t&&(this.column=0,this.line++),this.column++,t},n.Parser.prototype.nextCharCode=function(){do if(this.look=this.nextCharCodeRaw(),35==this.look)for(;10!=this.look&&this.look!=l;)this.look=this.nextCharCodeRaw();while(this.look!=l&&35==this.look)},n.Parser.prototype.skipWhite=function(){for(;this.look!=l&&t(this.look);)this.nextCharCode()},n.Parser.prototype.matchCharCode=function(t,e){if(this.look!=t)throw void 0===e&&(e="Expected '"+f(t)+"', but '"+f(this.look)+"' was found instead"),new n.ParseError(this,e);this.nextCharCode()},n.Parser.prototype.parseKey=function(){for(var t=null;this.look!=l&&e(this.look);)null===t&&(t=""),t+=f(this.look),this.nextCharCode();if(null===t)throw new n.ParseError(this,"key expected");return t},n.Parser.prototype.parseString=function(t){this.matchCharCode(34);for(var e='"',r="";34!=this.look&&this.look!=l;){if(e+=f(this.look),92==this.look)switch(this.look=this.nextCharCodeRaw()){case 34:this.look=34;break;case 110:this.look=10;break;case 114:this.look=13;break;case 116:this.look=9;break;case 92:this.look=92;break;default:var o=this.nextCharCodeRaw();if(!s(o)||!s(this.look))throw new n.ParseError(this,"invalid escape sequence");this.look=16*i(this.look)+i(o)}r+=f(this.look),this.look=this.nextCharCodeRaw()}return this.matchCharCode(34),e+='"',t.add(n.ANNOT_STRING),this.cast(t,e,r)},n.Parser.prototype.parseList=function(e){this.matchCharCode(91),this.skipWhite();for(var s=[];93!=this.look;){s.push(this.parseValue());var r=t(this.look);if(this.skipWhite(),44==this.look)this.nextCharCode();else if(!r&&!t(this.look))break;this.skipWhite()}return this.matchCharCode(93),e.add(n.ANNOT_LIST),this.cast(e,null,s)},n.Parser.prototype.parseDict=function(t){this.matchCharCode(123),this.skipWhite();var e=this.parseKeyValItems(125);return this.matchCharCode(125),t.add(n.ANNOT_DICT),this.cast(t,null,e)},n.Parser.prototype.parseBoolean=function(t){t.add(n.ANNOT_BOOL);var e=f(this.look);if(84==this.look||116==this.look)return this.nextCharCode(),this.matchCharCode(114),this.matchCharCode(117),this.matchCharCode(101),this.cast(t,e+"rue",!0);if(70==this.look||102==this.look)return this.nextCharCode(),this.matchCharCode(97),this.matchCharCode(108),this.matchCharCode(115),this.matchCharCode(101),this.cast(t,e+"alse",!1);throw new n.ParseError(this,"boolean value expected")},n.Parser.prototype.parseNumber=function(t){var e="",s=!1;(43==this.look||45==this.look)&&(e+=f(this.look),this.nextCharCode(),s=!0);var i=!1,h=!1;48==this.look&&(e+="0",this.nextCharCode(),88==this.look||120==this.look?(e+=f(this.look),this.nextCharCode(),h=!0):o(this.look)&&(i=!0));for(var a=!1,u=!1;this.look!=l&&r(this.look);)if(h||69!=this.look&&101!=this.look){if(46==this.look){if(a||h||i)throw new n.ParseError(this,"invalid number");a=!0}if(43==this.look||45==this.look)throw new n.ParseError(this,"invalid number");e+=f(this.look),this.nextCharCode()}else{if(u)throw new n.ParseError(this,"invalid number");e+="e",u=!0,this.nextCharCode(),(43==this.look||45==this.look)&&(e+=f(this.look),this.nextCharCode())}if(0==e.length)throw new n.ParseError(this,"number expected");if(h){if(u||a)throw new n.ParseError(this,"invalid hex number");return t.add(n.ANNOT_INT),this.cast(t,e,d(e,16))}if(i){if(u||a)throw new n.ParseError(this,"invalid octal number");return t.add(n.ANNOT_INT),this.cast(t,e,d(e,8))}return a||u?(t.add(n.ANNOT_FLOAT),this.cast(t,e,k(e))):(t.add(n.ANNOT_INT),this.cast(t,e,d(e,10)))},n.Parser.prototype.parseAnnotations=function(){for(var t=new u;58==this.look;){this.nextCharCode();var e=this.parseKey();if(t.contains(e))throw new ParseError(this,"duplicate annotation: "+e);t.add(e),this.skipWhite()}return t},n.Parser.prototype.parseValue=function(){var t=this.parseAnnotations();switch(this.look){case 34:return this.parseString(t);case 91:return this.parseList(t);case 123:return this.parseDict(t);case 84:case 116:case 70:case 102:return this.parseBoolean(t);default:return this.parseNumber(t)}},n.Parser.prototype.parseKeyValItems=function(e){for(var s={};this.look!=e&&this.look!=l;){var r=this.parseKey(),o=!1;if(t(this.look)?(o=!0,this.skipWhite()):58==this.look?(o=!0,this.nextCharCode(),this.skipWhite()):(123==this.look||91==this.look)&&(o=!0),!o)throw new n.ParseError(this,"missing separator");if(s[r]=this.parseValue(),44==this.look)this.nextCharCode();else if(this.look!=e&&!t(this.look))break;this.skipWhite()}return s},n.Parser.prototype.parseMessage=function(){var t=null;return this.framed?this.look!=l&&(this.matchCharCode(123),this.nextCharCode(),this.skipWhite(),t=this.parseKeyValItems(125),this.matchCharCode(125,"unterminated message, '}' expected"),this.skipWhite()):t=this.parseKeyValItems(l),t},n.load=function(t,e){return new n.Parser(String(t),e).parseMessage()},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.hipack=n):h.hipack=n}).call(this);
//# sourceMappingURL=hipack.min.map